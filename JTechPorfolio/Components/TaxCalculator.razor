@page "/taxcalculator"

<PageTitle>Joel's Portfolio | Tax Calculator</PageTitle>

<MudContainer Class="d-flex justify-center mud-width-full mt-2">
    <MudPaper Width="50%" Class="content-contanier mx-auto my-3 p-1">
        <MudText Typo="@Typo.h4" Class="text-center">Tax Calculator</MudText>
        <MudPaper class="input-container p-3">
            <EditForm class="center-content" Model="@newTax" OnValidSubmit="CalculateTax">
                <MudGrid>
                    <MudItem xs="12">
                        <MudNumericField Color="Color.Primary" Variant="Variant.Outlined" T="decimal" HideSpinButtons="true" Culture="System.Globalization.CultureInfo.CurrentCulture"
                                         Immediate="false" Label="Input Amount" Format="N2" @bind-Value="newTax.InputAmount" Class="my-lg-5 num-text-align" />

                    </MudItem>

                    <MudDivider />

                    <MudItem xs="6" Class="d-flex-inline">
                        <MudNumericField Color="Color.Primary" Variant="Variant.Outlined" T="decimal" HideSpinButtons="true" Culture="System.Globalization.CultureInfo.CurrentCulture"
                                         Immediate="false" Label="Tax #1" Format="N2" @bind-Value="newTax.TaxOneAmount" Class="my-md-5 num-text-align" />

                        <MudNumericField Color="Color.Primary" Variant="Variant.Outlined" T="decimal" HideSpinButtons="true" Culture="System.Globalization.CultureInfo.CurrentCulture"
                                         Immediate="false" Label="Tax #2" Format="N2" @bind-Value="newTax.TaxTwoAmount" Class="my-md-5 num-text-align" />
                    </MudItem>

                    <MudItem xs="6">
                        <MudNumericField Color="Color.Primary" Variant="Variant.Outlined" T="decimal" HideSpinButtons="true" Culture="System.Globalization.CultureInfo.CurrentCulture"
                                         Immediate="false" Label="Tax #3" Format="N2" @bind-Value="newTax.TaxThreeAmount" Class="my-md-5 num-text-align" />

                        <MudNumericField Color="Color.Primary" Variant="Variant.Outlined" T="decimal" HideSpinButtons="true" Culture="System.Globalization.CultureInfo.CurrentCulture"
                                         Immediate="false" Label="Tax #4" Format="N2" @bind-Value="newTax.TaxFourAmount" Class="my-md-5 num-text-align" />
                    </MudItem>
                </MudGrid>
            </EditForm>

            <MudGrid class="center-content">
                <MudItem xs="6">
                    <MudButton Class="w-50" Variant="Variant.Filled" OnClick="CalculateTax" Color="Color.Success">Calculate</MudButton>
                </MudItem>
                <MudItem xs="6">
                    <MudButton Class="w-50" Variant="Variant.Filled" OnClick="ClearValues" Color="Color.Error">Clear</MudButton>
                </MudItem>
            </MudGrid>
        </MudPaper>

        <MudDivider />

        <MudContainer Class="p-3">
            <MudGrid>
                <MudItem xs="3">
                    <MudText>Tax #1</MudText>
                    <MudPaper Elevation="1" Class="text-end border-solid fw-bold p-2">$@taxOneAmount</MudPaper>
                </MudItem>

                <MudItem xs="3">
                    <MudText>Tax #2</MudText>
                    <MudPaper Class="text-end border-solid fw-bold p-2">$@taxTwoAmount</MudPaper>
                </MudItem>

                <MudItem xs="3">
                    <MudText>Tax #3</MudText>
                    <MudPaper Class="text-end border-solid fw-bold p-2">$@taxThreeAmount</MudPaper>
                </MudItem>

                <MudItem xs="3">
                    <MudText>Tax #4</MudText>
                    <MudPaper Class="text-end border-solid fw-bold p-2">$@taxFourAmount</MudPaper>
                </MudItem>

                <MudFlexBreak />

                <MudItem Class="my-1" xs="12">
                    <MudText>Total Tax Amount</MudText>
                    <MudPaper Class="text-end border-solid fw-bold p-2">$@totalTax</MudPaper>
                </MudItem>

                <MudDivider />

                <MudItem xs="12">
                    <MudText>Total</MudText>
                    <MudPaper Style="background-color: darkgreen" Class="border-solid p-3">
                        <MudText Class="text-end border-solid fw-bold text-white">$@totalAmount</MudText>
                    </MudPaper>
                </MudItem>
            </MudGrid>
        </MudContainer>
    </MudPaper>
</MudContainer>

@code {
    TaxCalculatorModel newTax = new();

    decimal totalAmount = 0;
    decimal taxOneAmount = 0m;
    decimal taxTwoAmount = 0m;
    decimal taxThreeAmount = 0m;
    decimal taxFourAmount = 0m;
    decimal totalTax = 0m;

    private async void CalculateTax()
    {
        if (newTax.InputAmount > 0)
        {
            if (newTax.TaxOneAmount > 0)
            {
                string taxOne = (newTax.InputAmount * (newTax.TaxOneAmount / 100)).ToString("N2");

                decimal taxValue = 0m;
                bool isValid = decimal.TryParse(taxOne, out taxValue);

                if (isValid)
                    taxOneAmount = taxValue;
            }

            if (newTax.TaxTwoAmount > 0)
            {
                string taxTwo = (newTax.InputAmount * (newTax.TaxTwoAmount / 100)).ToString("N2");

                decimal taxValue = 0m;
                bool isValid = decimal.TryParse(taxTwo, out taxValue);

                if (isValid)
                    taxTwoAmount = taxValue;
            }

            if (newTax.TaxThreeAmount > 0)
            {
                string taxThree = (newTax.InputAmount * (newTax.TaxThreeAmount / 100)).ToString("N2");

                decimal taxValue = 0m;
                bool isValid = decimal.TryParse(taxThree, out taxValue);

                if (isValid)
                    taxThreeAmount = taxValue;
            }

            if (newTax.TaxFourAmount > 0)
            {
                string taxFour = (newTax.InputAmount * (newTax.TaxFourAmount / 100)).ToString("N2");

                decimal taxValue = 0m;
                bool isValid = decimal.TryParse(taxFour, out taxValue);

                if (isValid)
                    taxFourAmount = taxValue;
            }
            totalTax = taxOneAmount + taxTwoAmount + taxThreeAmount + taxFourAmount;
            totalAmount = newTax.InputAmount + totalTax;
        }
    }

    private void ClearValues()
    {
        newTax = new();
        totalAmount = 0;
        taxOneAmount = 0m;
        taxTwoAmount = 0m;
        taxThreeAmount = 0m;
        taxFourAmount = 0m;
        totalTax = 0m;
    }
}