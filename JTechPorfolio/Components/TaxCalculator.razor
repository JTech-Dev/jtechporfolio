@page "/tax"

<PageTitle>JTech Porfolio | Tax Calculator</PageTitle>

<EditForm class="row my-2 mx-2" Model="@newTax" OnValidSubmit="CalculateTax">
    <MudGrid>
        <MudItem>
            <MudNumericField Variant="Variant.Outlined" T="decimal" HideSpinButtons="true" Culture="System.Globalization.CultureInfo.CurrentCulture"
            Immediate="false" Label="Input Amount" Format="N2" @bind-Value="newTax.InputAmount" Class="my-lg-5"/>

            <MudNumericField Variant="Variant.Outlined" T="decimal" HideSpinButtons="true" Culture="System.Globalization.CultureInfo.CurrentCulture"
                             Immediate="false" Label="Tax #1" Format="N2" @bind-Value="newTax.TaxOneAmount" Class="my-md-5" />

            <MudNumericField Variant="Variant.Outlined" T="decimal" HideSpinButtons="true" Culture="System.Globalization.CultureInfo.CurrentCulture"
                             Immediate="false" Label="Tax #2" Format="N2" @bind-Value="newTax.TaxTwoAmount" Class="my-md-5"/>

            <MudNumericField Variant="Variant.Outlined" T="decimal" HideSpinButtons="true" Culture="System.Globalization.CultureInfo.CurrentCulture"
                             Immediate="false" Label="Tax #3" Format="N2" @bind-Value="newTax.TaxThreeAmount" Class="my-md-5"/>

            <MudNumericField Variant="Variant.Outlined" T="decimal" HideSpinButtons="true" Culture="System.Globalization.CultureInfo.CurrentCulture"
                             Immediate="false" Label="Tax #4" Format="N2" @bind-Value="newTax.TaxFourAmount" Class="my-md-5" />
        </MudItem>

        @* <MudItem>
            <MudButton Variant="Variant.Outlined" Color="Color.Primary">Calculate</MudButton>
        </MudItem> *@
    </MudGrid>
    @* <InputNumber class="form-control mx-2" style="width: 50%;" @bind-Value="newTax.InputAmount" placeholder="Input Amount" />
    
    <InputNumber class="form-control col m-2" @bind-Value="newTax.TaxOneAmount" placeholder="Tax #1" />
    <InputNumber class="form-control col m-2" @bind-Value="newTax.TaxTwoAmount" placeholder="Tax #2" />
    <InputNumber class="form-control col m-2" @bind-Value="newTax.TaxThreeAmount" placeholder="Tax #3" />
    <InputNumber class="form-control col m-2" @bind-Value="newTax.TaxFourAmount" placeholder="Tax #4" />

    <div>
        <button class="col-1 my-2 btn btn-outline-primary w-25" type="submit">Calculate</button>
    </div> *@
</EditForm>

<MudGrid class="m-2">
    <MudItem>
        <MudButton Variant="Variant.Outlined" OnClick="CalculateTax" Color="Color.Primary">Calculate</MudButton>
    </MudItem>
    <MudItem>
        <MudButton Variant="Variant.Outlined" OnClick="ClearValues" Color="Color.Error">Clear</MudButton>
    </MudItem>
</MudGrid>

<MudDivider />

@if (totalAmount > 0)
{
    <MudGrid Class="m-1">
        <MudItem Class="my-2" xs="3">
           @*  <MudText>Tax #1 Amount: $@taxOneAmount</MudText> *@
            <MudPaper Class="border-solid p-3">
                Tax #1 Amount: $@taxOneAmount
            </MudPaper>
        </MudItem>

        <MudItem Class="my-2" xs="3">
            @* <MudText>Tax #2 Amount: $@taxTwoAmount</MudText> *@
            <MudPaper Class="border-solid p-3">
                Tax #2 Amount: $@taxTwoAmount
            </MudPaper>
        </MudItem>

        <MudFlexBreak />

        <MudItem Class="my-2" xs="3">
            <MudPaper Class="border-solid p-3">
                Tax #3 Amount: $@taxThreeAmount
            </MudPaper>
        </MudItem>

        <MudItem Class="my-2" xs="3">
            @* <MudText>Tax #4 Amount: $@taxFourAmount</MudText> *@
            <MudPaper Class="border-solid p-3">
                Tax #4 Amount: $@taxFourAmount
            </MudPaper>
        </MudItem>

        <MudFlexBreak />

        <MudItem Class="my-2" xs="6">
            <MudPaper Class="border-solid p-3">
                Total Tax Amount: $@totalTax
            </MudPaper>
            @* <MudText>Total Tax Amount: $@totalTax</MudText> *@
        </MudItem>

        <MudDivider />

        <MudItem Class="my-2" xs="6">
            <MudPaper Style="background-color: darkgreen" Class="border-solid p-3">
                <MudText style="color: white;">Total: $@totalAmount</MudText>
            </MudPaper>
        </MudItem>
    </MudGrid>
}

@code {
    TaxCalculatorModel newTax = new();
    decimal totalAmount = 0;

    decimal taxOneAmount = 0m;
    decimal taxTwoAmount = 0m;
    decimal taxThreeAmount = 0m;
    decimal taxFourAmount = 0m;

    decimal totalTax = 0m;

    private void CalculateTax()
    {
        if (newTax.InputAmount > 0)
        {
            if (newTax.TaxOneAmount > 0)
            {
                string taxOne = (newTax.InputAmount * (newTax.TaxOneAmount / 100)).ToString("N2");

                decimal taxValue = 0m;
                bool isValid = decimal.TryParse(taxOne, out taxValue);

                if (isValid)
                    taxOneAmount = taxValue;
            }

            if (newTax.TaxTwoAmount > 0)
            {
                string taxTwo = (newTax.InputAmount * (newTax.TaxTwoAmount / 100)).ToString("N2");

                decimal taxValue = 0m;
                bool isValid = decimal.TryParse(taxTwo, out taxValue);

                if (isValid)
                    taxTwoAmount = taxValue;
            }

            if (newTax.TaxThreeAmount > 0)
            {
                string taxThree = (newTax.InputAmount * (newTax.TaxThreeAmount / 100)).ToString("N2");

                decimal taxValue = 0m;
                bool isValid = decimal.TryParse(taxThree, out taxValue);

                if (isValid)
                    taxThreeAmount = taxValue;
            }

            if (newTax.TaxFourAmount > 0)
            {
                string taxFour = (newTax.InputAmount * (newTax.TaxFourAmount / 100)).ToString("N2");

                decimal taxValue = 0m;
                bool isValid = decimal.TryParse(taxFour, out taxValue);

                if (isValid)
                    taxFourAmount = taxValue;
            }

            totalTax = taxOneAmount + taxTwoAmount + taxThreeAmount + taxFourAmount;
            totalAmount = newTax.InputAmount + totalTax;
        }
    }

    private void ClearValues()
    {
        newTax = new();
        totalAmount = 0;
        taxOneAmount = 0m;
        taxTwoAmount = 0m;
        taxThreeAmount = 0m;
        taxFourAmount = 0m;
        totalTax = 0m;
    }
}
